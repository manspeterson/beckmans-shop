<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        
        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
        <link rel="apple-touch-icon" href="apple-touch-icon.png">
        <!--<link rel="stylesheet" href="css/main.css"> -->
        <script src="js/data.js"></script>
        <style type="text/css">
          /* RESET */
  *,*:before,*:after{box-sizing:border-box;}html,body{margin:0;height:100%;}a{text-decoration:inherit;color:inherit;}p,h1,h2,h3,h4,h5,h6{margin:0;font-size:inherit;font-weight:inherit;}ul,ol{margin:0;padding:0;list-style-type:none;}img{display:inline-block;border:0;max-width:100%;height:auto;vertical-align:middle;}figure{margin:0;}


        	.hidden {
        		display: none;
        	}

          body, input  {
            font-family: "Univers LT Std", sans-serif;
            font-size: 0.95vw;
            line-height: 1.4;
            font-weight: normal;
            float: left;
            width: 100%;
            height: 100%;
            -webkit-font-smoothing: antialiased;
            /*padding: 0.5% 0.5% 0.5% 0;*/
          }
          header {
            width: 100%;
            float:left;
            background: white;
          }
          body > header {
            position: fixed;
            left: 0%;
            top: 0%;
            padding: 0.5%;
            z-index: 100;
          }

          input {
            border: none;
            outline: none;
          }
          

          main header {
            padding: 0.5%;
            padding-top: 0;
          }

          .col-margin {
            width: 2%;
            float:left;
          }

          .col-1 {
            width: 20%;
            float:left;
            padding-left: 2%;
          }
          body > header .col-1:nth-child(2) {
            width: 18%;
            padding-left:0;
          }

          article img {
            width: auto;
            height: auto;
            padding: 0 0 0.5% 0.5%;
          }

          .small article img {
            max-height: 30vw;
            cursor: zoom-in;
          }
          .big article img, .productView.small article img {
            /*max-height: 50vw;*/
            max-height: 63vw;

            cursor: zoom-out;
          }
          .productView article img {
            cursor: initial !important;
          }

          article {
            padding-bottom: 5vw;
          }
          main {
            padding-top: 5vw;
            padding-bottom: 30vh;
          }

          main article aside {
            padding-right: 0.5%;
            width: 100%;

          }

      

          .current {
            /*font-style: italic;*/
          }
          main article header {
            position: absolute;
          }
          main article aside {
            padding-top: 1.81vw;
          }
          main article.current header {
            position: fixed;
            top: 2%;
          }

          main article.current header {
            visibility: hidden;
          }
          main article.current:last-child header {
            visibility: visible;
          }
          
          main article.prev header {
            opacity: 0;
          }

          body.overview, body.overview > header {
            background: black;
            color: white;
          }
          body.overview {
            height: 100vw;
            overflow: hidden;
          }

          #overview {
            position: fixed;
            left: 0;
            top: 0;
            z-index: 10;
            background: black;
            display: none;
            width: 100%;
            height: 100%;
          }
          #overview aside, main article aside.buy-info {
            padding: 0.5%;
            padding-top: 5vw;
          }
  
          main article aside.buy-info {
            float: left;
            padding-bottom: 3.19vh;
            display: none;
          }

          .overview #overview {
            display: block;
            line-height: 1.6;
          }

          button {
            border:none;
            background:none;
            padding: 0;
            margin: 0;
            cursor: pointer;
            text-align: left;
            font-size: inherit;
            line-height: inherit;
            text-decoration: underline;
          }

          .productView article, .back {
            display: none;
          }

          .productView article.focusProduct, .productView main article aside.buy-info, .productView .back {
            display: block;
          }
          .productView main {
            padding-top: 0.5%;
          }

          .back, .productView .info {
            display: none;
          }


        </style>
    </head>
    <body class="small">
      <header>
          <div class="col-margin">
              <h1>BS</h1></div>
          <div class="col-1 current"><a href="">Produkter</a></div>
          <div class="col-1"><a href="">Designers</a></div>
          <div class="col-1"><a href="">Taggar</a></div>
          <div class="col-1"><a href="">Pris</a></div>
          <div class="col-1"><a href="">Information</a></div>
      </header>
  <main></main>
  <section id="overview"><aside></aside></section>
      
    <script src="js/jquery-3.2.1.min.js"></script>
      <script type="text/javascript">
        function shuffleArray(array) {
            for (var i = array.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        function toTitleCase(str) {
          return str.toLowerCase().split(' ').map(function(word) {
            return word.replace(word[0], word[0].toUpperCase());
          }).join(' ');
        }
        function addProduct(p){
          article = $('<article/>');
          header = $('<header/>');
          titel = $('<div class="col-1"/>').addClass('titel').text(toTitleCase(p["titel"]));
          designer = $('<div class="col-1"/>').addClass('designer').text(toTitleCase(p["designer"]));
          taggar = $('<div class="col-1"/>').addClass('taggar').text(toTitleCase(p["taggar"]));
          pris = $('<div class="col-1"/>').addClass('pris').text(toTitleCase(p["pris"] + "") + " SEK");
          info = $('<div class="col-1"/>')
          infoText = $('<a href="info"/>').addClass('info').text("Mer Info/Köp");
          backText = $('<a href="back"/>').addClass('back').text("Gå Tillbaka");
          info.append(infoText, backText);

          header.append(titel, designer, taggar, pris, info);

          kopInfo = $('<aside class="buy-info"/>');
          u = data.users[p["designer-slug"]]

          beskrivning = $('<div class="col-1"/>').addClass('beskrivning').html(p["beskrivning"].replace(/\n/g, "<br />"));
          userInfo = $('<div class="col-1"/>').addClass('designer-info').html(u.klass + "<br>Mail, Portfolio");

          formContent = $('<form class="buy-form" netlify/>').attr("name", 'buy').attr('netlify-honeypot', 'bot-field').attr('action', 'thank-you');
          formLeftCol = $('<div class="col-1"/>');
          formRightCol = $('<div class="col-1"/>');
          // formContent.append('<p class="hidden"><label>Don’t fill this out: <input name="bot-field"></label></p>')

          nameInput = $('<input/>').attr('type', "text").attr('name','buyer-name').attr('placeholder', 'För- & Efternamn');
          mailInput = $('<input/>').attr('type', "email").attr('name','buyer-email').attr('placeholder', 'E-mail');
          streetInput = $('<input/>').attr('type', "text").attr('name','buyer-address').attr('placeholder', 'Leveransadress');
          postalCodeInput = $('<input/>').attr('type', "text").attr('name','buyer-postalcode').attr('placeholder', 'Postnummer & Ort').addClass('small');
    
           sellerMailInput = $('<input hidden/>').attr('type', "email").attr('name','seller-email').attr('value', u.email);
           sellerPhoneInput = $('<input hidden/>').attr('type', "number").attr('name','seller-phone').attr('value', u["swish-nr"]);
           sellerSumInput = $('<input hidden/>').attr('type', "number").attr('name','price').attr('value', p.pris);
           sellerProductInput = $('<input hidden/>').attr('type', "text").attr('name','product').attr('value', p.titel);
           sellerCodeInput = $('<input hidden/>').attr('type', "text").attr('name','qr-code').attr('value', 'C' + u["swish-nr"] + ';' + u.pris + ";" + p.titel + ";0");

           formLeftCol.append(nameInput, mailInput, streetInput, postalCodeInput, sellerMailInput, sellerPhoneInput, sellerSumInput, sellerProductInput, sellerCodeInput);

           
           buyButton = $('<button />').attr('type', 'submit').text("Köp");
           formRightCol.append(buyButton);

           formContent.append(formLeftCol, formRightCol);

          kopInfo.append(beskrivning, userInfo, formContent);
          aside = $('<aside class="images"/>');
          for (img in p["bilder"]){
            i = $('<img/>').attr('src', p["bilder"][img]);
            aside.append(i);
          }
          article.append(header, kopInfo, aside);
          $('main').first().append(article);
        }

        function populateProducts(ps){
          for (x in ps){
            addProduct(ps[x]);
          }
        }
        function populateOverview(){
          info = "Beckmans Shop (BS) är en oberoende marknadsplats för Beckmansstudenter där de erbjuder sina verk till försäljning. <br><br>Alla priser är inkl. frakt (inom Sverige) och betalning sker via Swish. Varje student ansvarar själv för försäljning och skatt.<br><br>Webshopen är designad och utvecklad av Måns Peterson."

          productList = []
          for (x in data.products) {
            productList.push(toTitleCase(data.products[x]["titel"]));
          }
          productList.sort();
          
          userList = []
          for (x in data.users) {
            userList.push(toTitleCase(data.users[x].namn));
          }
          userList.sort();
           for (x in data.taggar) data.taggar[x] = toTitleCase(data.taggar[x]);

          titlar = $('<div class="col-1"/>').addClass('titlar').html(productList.join("<br/>"));
          designers = $('<div class="col-1"/>').addClass('designers').html(userList.join("<br/>"));
          taggar = $('<div class="col-1"/>').addClass('taggar').html(data.taggar.join("<br/>"));
          information = $('<div class="col-1"/>').addClass('siteinfo').html(info);
          pris = $('<div class="col-1"/>').addClass('pris').html(["<500 SEK", "500–1 000 SEK", ">1 000 SEK"].join("<br/>"));
          // designers = $('<div class="col-1"/>').addClass('designer').text(toTitleCase(p["designer"]));
          // taggar = $('<div class="col-1"/>').addClass('taggar').text(toTitleCase(p["taggar"]));
          // pris = $('<div class="col-1"/>').addClass('pris').text(toTitleCase(p["pris"] + "") + " SEK");
          // info = $('<div class="col-1"/>').addClass('info').text("Mer Info/Köp");
          $('#overview aside').first().append(titlar, designers, taggar, pris, information);//, designer, taggar, pris, info);
        }

        var size = ["small", "big"];
        var counter = 0;
        var lastScroll = 0;
        var scrollMemory = 0;
        var headerClicked = false;
        prevPos = $('header').height();

        data.products = shuffleArray(data.products);
        populateProducts(data.products);

        $('main article').first().addClass('next');
        populateOverview();
        $(window).scrollTop(0);

        $("form.buy-form").submit(function(e) {
              e.preventDefault();
              var $form = $(this);
              $.post($form.attr("action"), $form.serialize()).then(function() {
                alert("Thank you!");
              });
        });

        $('.info').click(function(e){
          e.preventDefault();
          scrollMemory = $(window).scrollTop();
          $('body').addClass('productView');
          $(this).parent().parent().parent().addClass('focusProduct');
          $(this).parent().parent().parent().addClass('current');
          $(window).scrollTop(0);
          $(this).parent().parent().css('top', $('body > header').first()[0].getBoundingClientRect().height + 'px');
        })

        $('.back').click(function(e){
          e.preventDefault();
          $('body').removeClass('productView');
          $(this).parent().parent().parent().removeClass('focusProduct');
          $(this).parent().parent().parent().removeClass('current').addClass('next');
          $(window).scrollTop(scrollMemory);
          $(this).parent().parent().css('top', 'auto');
        })



        $('img').click(function(e){
          e.preventDefault();
          var scrollTop     = $(window).scrollTop(),
              elementOffset = $(this).offset().top,
              distance      = (elementOffset - scrollTop);
          prev = size[counter % 2]; 
          counter++; next = size[counter % 2]; 
          $('body').removeClass(prev); 
          $('body').addClass(next);
          newOffset = $(this).offset().top;
          $(window).scrollTop(newOffset - distance);
        });

        $('body > header a').on('mouseenter', function(e){
          e.preventDefault();
          $('body').addClass('overview');

        });
        $('body > header a').on('mouseleave', function(e){
          e.preventDefault();
          if (!headerClicked) $('body').removeClass('overview');
        })
        $('body > header a').on('click', function(e){
          e.preventDefault();
          headerClicked = !headerClicked;
          if (!headerClicked) {$('body').removeClass('overview'); $('h1').first().text('BS');
          } else {
            $('h1').first().text('X');
            $('body').addClass('overview');
          }
        })

        $(window).scroll(function(){
          header = $('body > header').first();
          scrollDown = lastScroll - $(window).scrollTop() < 0 ? true : false;
          lastScroll = $(window).scrollTop();
  
          headerBounding = header[0].getBoundingClientRect();
          if (!scrollDown && $('main article.current').length != 0) {
            current = $('main article.current').last();
            currentBounding = current[0].getBoundingClientRect();
            if (headerBounding.top <= currentBounding.top + currentBounding.height && headerBounding.top + headerBounding.height > currentBounding.top) {}else {
                current.removeClass('current').addClass('next')
                current.find('header').css('top','auto');
            }
          } else if (scrollDown && $('main article.next').length != 0) {
            next = $('main article.next').first();
            nextBounding = next[0].getBoundingClientRect();
            if (headerBounding.top <= nextBounding.top + nextBounding.height && headerBounding.top + headerBounding.height > nextBounding.top) {
              next.addClass('current').removeClass('next');
              next.find('header').first().css('top', headerBounding.height + 'px');
              if (next.nextUntil().length != 0) next.next().addClass('next');
            }
          }
        })

        $(function(){
          $(window).scrollTop(0);
        });
      </script>
    </body>
</html>